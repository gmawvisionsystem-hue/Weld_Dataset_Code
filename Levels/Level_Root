
cd('C:\Users\Kevin Velasquez\Documents\Contrato_0_Proyecto_Soldadura\Imagenes\Ground_Truth\Root')
ApiKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbHgycDN6emkwM3prMDcwZzFhbnI4OHZoIiwib3JnYW5pemF0aW9uSWQiOiJjbHgycDN6eXYwM3pqMDcwZ2RzamVkOGNrIiwiYXBpS2V5SWQiOiJjbHo2aGdtaXAxaWgwMDd3dTk0Y3RoMDF2Iiwic2VjcmV0IjoiYjYwZWNjMGExZDUwZWUxMzVhMTgxYjQ2MGQ1ZmY4MTAiLCJpYXQiOjE3MjIyMjY5NTMsImV4cCI6MjM1MzM3ODk1M30.IxYwJnAXFSkIGD18D_iBaFO_jLY1GxcddZ0XoAAuvwY';

[m n] = size(data);
% URL de la imagen que quieres descargar desde Labelbox

% Api Key 
for i=1:n

    image_id = data{1,i}.data_row.external_id;
    cd('C:\Users\Kevin Velasquez\Documents\Contrato_0_Proyecto_Soldadura\Imagenes\labelbox\root')
    folder = split(image_id,".");
    mkdir(folder{1})
    cd(folder{1})
    if isempty(data{1,i}.projects.clx9q8l8b001807wbguwt4ulb.labels.annotations.objects)
        im_empty = uint8(2*ones(2800));
        cd('C:\Users\Kevin Velasquez\Documents\Contrato_0_Proyecto_Soldadura\Imagenes\root\label')
        imwrite(im_empty,image_id);
    else
        [k l] = size(data{1,i}.projects.clx9q8l8b001807wbguwt4ulb.labels.annotations.objects);
        for j = 1:k

            link = data{1,i}.projects.clx9q8l8b001807wbguwt4ulb.labels.annotations.objects(j).mask.url;
            name = data{1,i}.projects.clx9q8l8b001807wbguwt4ulb.labels.annotations.objects(j).name;
            %Descarga de imagen
            headers = {'Authorization', ['Bearer ', ApiKey]};
            options = weboptions('HeaderFields', headers);
            websave([name '.png'], link, options);
        end

        % ______________________________________________________________________
        list = dir('*.png');
        [a ~] = size(list);
        M = uint8(2*ones(2800));

        for q = 1:a
            id = list(q).name;
            im = imread(id);
            IM1 = im/255;
            IM2 = 2*IM1;
            if strcmp(id,'penetrationExceed.png')              
                M = M - IM2;
            else
                M = M - IM1;
            end
        end
        cd('C:\Users\Kevin Velasquez\Documents\Contrato_0_Proyecto_Soldadura\Imagenes\root\label')
        imwrite(M,image_id);

        %___________________________________________________________________________________------
       
    end
end
   
